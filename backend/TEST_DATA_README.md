# Тестовые данные для Bazarlar Online

## Описание

SQL скрипт для создания тестовых бизнес-данных (продавцов, товаров, покупателей, заказов и отзывов).

**Важно:** Справочные данные (города, рынки, категории) должны быть созданы заранее через миграции базы данных.

## Что включено

**create_test_data.sql** - единый скрипт с бизнес-данными:

### Пользователи:
- **1 администратор**: admin@bazarlar.online (тариф: business)
- **1 базовый продавец**: seller@bazarlar.online (тариф: pro)
- **10 тестовых продавцов** с различными профилями:
  1. Айгуль Асанова - "Модный стиль" (одежда, Дордой)
  2. Тимур Бекмуратов - "TechnoShop" (электроника, бутик)
  3. Нургуль Токтогулова - "Фермерские продукты" (продукты, Ошский рынок)
  4. Эрлан Шаршеев - "Обувной мир" (обувь, магазин)
  5. Жанара Исакова - "BeautyKG" (косметика, офис)
  6. Назира Абдиева - "Детский рай" (детские товары, магазин)
  7. Азамат Мураталиев - "Спорт Лайф" (спорт, мобильный)
  8. Гулнара Сыдыкова - "Уют и комфорт" (товары для дома, Ош)
  9. Бактыгуль Жумабаева - "Silk Road Fashion" (одежда, Ош)
  10. Эмир Алиев - "Gadget Store" (электроника, Джалал-Абад)
- **8 тестовых покупателей**: Айнура, Бекзат, Гульнара, Данияр, Елена, Жамиля, Замир, Ильяс

### Товары и услуги:
**~40 товаров** в различных категориях:
- Одежда: футболки, платья, джинсы, куртки, шарфы
- Электроника: iPhone 15 Pro, Samsung Galaxy S24, Xiaomi, MacBook Pro, AirPods
- Продукты: молоко, яйца, овощи
- Обувь: кроссовки Nike, туфли, зимние ботинки
- Косметика: тональный крем, маски, помада
- Детские товары: коляски, конструкторы LEGO, комбинезоны
- Спорттовары: гантели, коврики для йоги, скакалки
- Товары для дома: постельное белье, полотенца, шторы

### Заказы и отзывы:
- **20 заказов** с различными статусами:
  - 15 завершенных заказов (completed) - с отзывами
  - 2 заказа в обработке (processing)
  - 3 новых заказа (pending)
- **15 отзывов** от покупателей с рейтингами от 7 до 10 баллов
  - Разнообразные комментарии на русском языке
  - Покрывают разных продавцов и категории товаров

## Предварительные требования

Перед загрузкой тестовых данных убедитесь, что:

1. **База данных создана** и миграции применены
2. **Справочники созданы**:
   - Города (cities)
   - Рынки (markets)
   - Категории (categories) - минимум 3 уровня

Если справочники не созданы, сначала примените миграции Alembic:

```bash
# В контейнере backend
docker exec -it bazarlar_backend alembic upgrade head
```

## Как загрузить данные

**ВАЖНО:** Запускайте скрипт только через `psql` с перенаправлением ввода, **НЕ через DBeaver**!

```bash
# 1. Убедитесь, что контейнеры запущены
docker compose up -d

# 2. Загрузите тестовые данные
docker exec -i bazarlar_postgres psql -U bazarlar_user -d bazarlar_claude < backend/create_test_data.sql
```

Скрипт выполнится как одна транзакция и покажет прогресс в реальном времени.

## Вывод при выполнении

Скрипт показывает прогресс выполнения:

```
========================================
СОЗДАНИЕ ТЕСТОВЫХ ДАННЫХ
========================================
✓ Создан администратор и базовый продавец
Создание продавцов и их товаров...
✓ Создано 10 продавцов с профилями
Создание товаров и услуг...
✓ Создано ~40 товаров и услуг
Создание покупателей...
✓ Создано 8 покупателей
Создание заказов и отзывов...
✓ Создано 20 заказов
✓ Создано 15 отзывов

========================================
ТЕСТОВЫЕ ДАННЫЕ УСПЕШНО СОЗДАНЫ!
========================================
Продавцов: 11
Товаров: ~40
Покупателей: 8
Заказов: 20
Отзывов: 15
========================================
```

## Проверка данных

После загрузки проверьте данные:

```bash
# Подключитесь к базе данных
docker exec -it bazarlar_postgres psql -U bazarlar_user -d bazarlar_claude

# Выполните SQL запросы:
SELECT COUNT(*) FROM users WHERE role='seller';   -- Должно быть 11
SELECT COUNT(*) FROM users WHERE role='user';     -- Должно быть 8 (покупатели)
SELECT COUNT(*) FROM seller_profiles;             -- Должно быть 11
SELECT COUNT(*) FROM products;                    -- Должно быть ~40
SELECT COUNT(*) FROM orders;                      -- Должно быть 20
SELECT COUNT(*) FROM reviews;                     -- Должно быть 15

# Проверить статусы заказов:
SELECT status, COUNT(*) FROM orders GROUP BY status;

# Проверить средний рейтинг отзывов:
SELECT AVG(rating) as avg_rating, MIN(rating) as min_rating, MAX(rating) as max_rating FROM reviews;
```

## Данные для входа (после настройки OAuth)

После настройки Google OAuth вы сможете войти используя email:
- **Администратор**: admin@bazarlar.online
- **Продавец**: seller@bazarlar.online
- **Тестовые продавцы**: seller1@test.com - seller10@test.com
- **Тестовые покупатели**: buyer1@test.com - buyer8@test.com

## Особенности

1. **ON CONFLICT DO NOTHING** - скрипт можно запускать многократно без дублирования данных
2. **Автоматическая генерация UUID** - используется gen_random_uuid()
3. **Автоматическая генерация referral_id** - уникальный код для каждого пользователя
4. **Изображения** - используются placeholder изображения (placehold.co)
5. **Реалистичные данные** - товары с характеристиками, заказы с адресами, отзывы с комментариями
6. **Временные метки** - заказы и пользователи созданы в разное время для реализма
7. **Диагностика** - скрипт выводит сообщения о прогрессе выполнения
8. **Итоговая статистика** - в конце скрипт показывает количество созданных записей

## Структура данных

```
Пользователи
├── Администратор (1)
├── Продавцы (11)
│   ├── С профилями продавцов
│   ├── С привязкой к городам и рынкам
│   └── С товарами (~4 товара на каждого)
└── Покупатели (8)
    ├── С заказами (15 completed, 2 processing, 3 pending)
    └── С отзывами (15 отзывов на completed заказы)
```

## Сброс данных

Если нужно сбросить данные и загрузить заново:

```sql
-- ВНИМАНИЕ: Это удалит ВСЕ бизнес-данные!
TRUNCATE TABLE reviews, orders, products, seller_profiles, users CASCADE;
```

Справочники (города, рынки, категории) при этом сохранятся.

## Старые скрипты

Следующие файлы устарели и больше не используются:
- ~~test_data.sql~~ - устарел
- ~~test_data_orders_reviews.sql~~ - устарел

Используйте только **create_test_data.sql**

## Техническая поддержка

Если возникли проблемы при загрузке:

1. Проверьте, что PostgreSQL запущен: `docker ps | grep postgres`
2. Проверьте логи: `docker logs bazarlar_postgres`
3. Проверьте подключение: `docker exec -it bazarlar_postgres psql -U bazarlar_user -d bazarlar_claude -c "SELECT version();"`
4. Убедитесь, что таблицы созданы: `docker exec -it bazarlar_postgres psql -U bazarlar_user -d bazarlar_claude -c "\dt"`
5. Убедитесь, что справочники заполнены:
   ```sql
   SELECT COUNT(*) FROM cities;     -- Должно быть > 0
   SELECT COUNT(*) FROM markets;    -- Должно быть > 0
   SELECT COUNT(*) FROM categories; -- Должно быть > 0
   ```
6. Проверьте вывод скрипта - он должен показывать прогресс создания данных

---
**Создано**: 2025-11-16
**Обновлено**: 2025-11-19 (убраны справочные данные, оставлены только бизнес-данные)
**Версия**: 3.0
